<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <link rel="stylesheet" href="./css/index.css" />
    <title>999儿童健康防护公益小课堂</title>
    <script>
        function setFS() {
            var html = document.querySelector('html');
            var width = html.getBoundingClientRect().width;
            html.style.fontSize = width / 750 + 'px';
        }
        setFS();
        window.addEventListener('resize', setFS);
    </script>
    <script>
        (function(a, e, f, g, b, c, d) {
         a.ClickiTrackerName = b;
         a[b] = a[b] || function() {(a[b].queue = a[b].queue || []).push(arguments)};
         a[b].start = +new Date; c = e.createElement(f); d = e.getElementsByTagName(f)[0];
         c.async = 1; c.src = g; d.parentNode.insertBefore(c, d)
        })(window, document, 'script', '//stm-cdn.cn.miaozhen.com/clicki.min.js?v='+Math.round(new Date().getTime()/1000/300), 'stm_clicki');
        stm_clicki('create', 'dc-2000615', 'auto');
        stm_clicki('send', 'pageview');
        </script>
    <script>
        (function (w, d, s, q, i) {
            w[q] = w[q] || [];
            var f = d.getElementsByTagName(s)[0], j = d.createElement(s);
            j.async = true;
            j.id = 'beacon-aplus';
            j.src = 'https://d.alicdn.com/alilog/mlog/aplus/' + i + '.js';
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'aplus_queue', '203467608');

        //集成应用的appKey
        aplus_queue.push({
            action: 'aplus.setMetaInfo',
            arguments: ['appKey', '65a5f53795b14f599d17d89a']
        });
    </script>
    <script src="https://s1.xmcdn.com/yx/web-jssdk/1.5.1/dist_cdn/xmsdk.min.js"></script>
    <script src="https://s1.xmcdn.com/lib/jssdk/1.1.1/build/ly.js"></script>
    <script src='https://res.wx.qq.com/open/js/jweixin-1.6.0.js' type='text/javascript'></script>
</head>

<body>
    <div class="wrap">
        <header class="header">
            <div style="display: none;"><img src="https://www.adtais.com/ximalaya/999xiaoerganmao/images/pic_share.jpg" /></div>
        </header>
        <section class="medal">
            <div class="btn_medal"></div>
        </section>
        <section class="list list_1">
            <div class="content">
                <div class="caption">
                    <div class="pic">
                        <img src="./images/pic_1.jpg" />
                    </div>
                    <div class="title"></div>
                </div>
                <a class="item" data-link="link1" data-name="【第二季】1、【侦探社】能治咳嗽的糖（上）" href="https://m.ximalaya.com/sound/654059423">
                    <span class="text"></span>
                    <span class="btn"></span>
                </a>
                <a class="item" data-link="link2" data-name="【第二季】2、【侦探社】能治咳嗽的糖（下）" href="https://m.ximalaya.com/sound/654059436">
                    <span class="text"></span>
                    <span class="btn"></span>
                </a>
                <a class="item" data-link="link3" data-name="【小知识】国家级非遗宝物——梨膏糖" href="https://m.ximalaya.com/sound/654059442">
                    <span class="text"></span>
                    <span class="btn"></span>
                </a>
            </div>
        </section>
        <section class="list list_2">
            <div class="content">
                <div class="caption">
                    <div class="pic">
                        <img src="./images/pic_2.jpg" />
                    </div>
                    <div class="title"></div>
                </div>
                <a class="item" data-link="link4" data-name="022 狐爸爸住院了1 |守护兽狐小九第一季" href="https://m.ximalaya.com/sound/545605707">
                    <span class="text"></span>
                    <span class="btn"></span>
                </a>
                <a class="item" data-link="link5" data-name="023 狐爸爸住院了2 |守护兽狐小九第一季" href="https://m.ximalaya.com/sound/545606302">
                    <span class="text"></span>
                    <span class="btn"></span>
                </a>
                <a class="item" data-link="link6" data-name="第二季16集 哮天犬鼻塞啦1 | 守护兽狐小九" href="https://m.ximalaya.com/sound/604117102">
                    <span class="text"></span>
                    <span class="btn"></span>
                </a>
            </div>
        </section>
        <section class="list list_3">
            <div class="content">
                <div class="caption">
                    <div class="pic">
                        <img src="./images/pic_3.jpg" />
                    </div>
                    <div class="title"></div>
                </div>
                <a class="item" data-link="link7" data-name="汉堡王子 | 第31口 惊人的发现" href="https://m.ximalaya.com/sound/544301396">
                    <span class="text"></span>
                    <span class="btn"></span>
                </a>
                <a class="item" data-link="link8" data-name="汉堡王子 | 第32口 汉堡包为什么不健康" href="https://m.ximalaya.com/sound/544565907">
                    <span class="text"></span>
                    <span class="btn"></span>
                </a>
                <a class="item" data-link="link9" data-name="汉堡王子 | 第33口 国王的选择" href="https://m.ximalaya.com/sound/544851112">
                    <span class="text"></span>
                    <span class="btn"></span>
                </a>
            </div>
        </section>
        <div class="mask disable fn-hide">
            <div class="mask_bg"></div>
            <div class="mask_wrap">
                <div class="btn_close"></div>
                <div class="text"></div>
                <div class="button"></div>
            </div>
            <div class="mask_pic fn-hide">
                <div class="btn_close"></div>
                <div class="pic_box"><img src="./images/pic_poster.jpg" /></div>
                <p>* 长按图片可进行分享</p>
            </div>
        </div>
    </div>

    <script src="./js/jquery-3.7.0.min.js"></script>
    <script src="./js/index.js"></script>

    <script>
        $(function () {
            var basicSiteUrl = 'https://www.adtais.com';
            var opt = {
                link: basicSiteUrl + '/ximalaya/999xiaoerganmao/',
                title: '999儿童健康防护公益小课堂',
                desc: '999小儿感冒药 邀请您听喜马拉雅儿童健康科普故事，为公益地区儿童送爱心口罩',
                img: basicSiteUrl + '/ximalaya/999xiaoerganmao/images/pic_share.jpg',
            };
            var mask = $('.mask');
            var btnMedal = $('.btn_medal');
            var medal = false;
            var linked = cookieset.get('linkClick');
            var cookieTime = 3 * 24 * 60 * 60 * 1000;

            linked.split(',').every(function (item) {
                $('.item[data-link="' + item + '"]').addClass('active');
                return true;
            });
            function setState() {
                var linked = cookieset.get('linkClick');
                var shared = cookieset.get('shareClick');
                if (!medal && linked) {
                    mask.removeClass('disable');
                    btnMedal.addClass('active');
                    medal = true;
                }
            }
            setState();

            var hideMask = function () {
                mask.addClass('fn-hide');
                $('html').css('overflow', 'auto');
            };
            $('.btn_medal').click(function() {
                setState();
                $('html').css('overflow', 'hidden');
                mask.removeClass('fn-hide');

                aplus_queue.push({
                    action: 'aplus.record',
                    arguments: [medal ? 'link14' : 'link10', 'CLK'],
                });
                stm_clicki('send', 'event', 'button', 'click', medal ? '查看我的勋章按钮' : '收听节目领取公益勋章按钮');
            });
            $('.btn_close').click(function () {
                hideMask();
            });

            $('.mask .button').click(function () {
                if (medal) {
                    aplus_queue.push({
                        action: 'aplus.record',
                        arguments: ['link11', 'CLK'],
                    });
                    stm_clicki('send', 'event', 'button', 'click', '分享勋章海报按钮');
                    $('.mask_wrap').addClass('fn-hide');
                    $('.mask_pic').removeClass('fn-hide');
                } else {
                    var t = $('.list_1').offset().top;

                    aplus_queue.push({
                        action: 'aplus.record',
                        arguments: ['link12', 'CLK'],
                    });
                    stm_clicki('send', 'event', 'button', 'click', '继续完成任务按钮');
                    window.scrollTo({
                        left: 0,
                        top: t,
                        behavior: 'smooth',
                    });
                    hideMask();
                }
            });


            $('.item').each(function (i) {
                $(this).click(function (e) {
                    var _this = $(this);
                    var timer = null;
                    var href = _this.attr('href');
                    var data = _this.attr('data-link');
                    var name = _this.attr('data-name');
                    aplus_queue.push({
                        action: 'aplus.record',
                        arguments: ['link' + (i + 1), 'CLK', {
                            name: name,
                        }],
                    });
                    stm_clicki('send', 'event', 'links', 'click', name);
                    _this.addClass('active');
                    var links = cookieset.get('linkClick');
                    links && links.split(',').some(function (item) {
                        if (item == data) {
                            return true;
                        }
                    }) ? '' : cookieset.set('linkClick', links ? (links + ',' + data) : data, {
                        expires: cookieTime,
                    });
                    timer = setTimeout(function () {
                        clearTimeout(timer);
                        location.href = href;
                        return true;
                    }, 500);
                    if (e && e.preventDefault) {
                        e.preventDefault();
                    } else {
                        window.event.returnValue = false;
                    }
                    return false;
                });
            });
            post({
                url: basicSiteUrl + '/tais-boot/h5/site/xmlyZzShareJsAuthorization',
                data: { codeLink: opt.link },
                callback: function (data) {
                    if (data.code == 200) {
                        var apiList = ['nav.setMenu', 'util.share'];
                        ly.config({
                            timestamp: data.result.timestamp,
                            nonce: data.result.nonceStr,
                            signature: data.result.signature,
                            appId: data.result.appId, // 必填，应用ID
                            apiList: apiList,
                        });
                        ly.ready(function () {
                            ly.invokeApp('nav.setMenu', {
                                items: [
                                    {
                                        id: '1',
                                        icon: 'share',
                                        text: '分享',
                                    },
                                ],
                                success() {
                                    ly.invokeApp('util.share', {
                                        channel: ['weixin', 'weixinGroup', 'xmTimeline'],
                                        title: opt.title,
                                        desc: opt.desc,
                                        link: opt.link,
                                        imgUrl: opt.img,
                                        type: 'link',
                                        success: function (data) {
                                            aplus_queue.push({
                                                action: 'aplus.record',
                                                arguments: ['link13', 'CLK', {
                                                    shareType: data.channel,
                                                }],
                                            });
                                            stm_clicki('send', 'event', 'share', 'click', '主 APP ' + data.channel);
                                            cookieset.set('shareClick', 'true', {
                                                expires: cookieTime,
                                            });
                                        },
                                    });
                                },
                            });
                        });
                        ly.error(function (err) {
                            console.warn(JSON.stringify(err));
                        });
                    }
                }
            });

            post({
                url: basicSiteUrl + '/tais-boot/sys/weixinAllJsAuthorization',
                data: { codeLink: window.location.href.split('#')[0] },
                callback: function (data) {
                    if (data.code == 200) {
                        wx.config({
                            debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                            appId: data.result.appId, // 必填，公众号的唯一标识
                            timestamp: data.result.timestamp, // 必填，生成签名的时间戳
                            nonceStr: data.result.nonceStr, // 必填，生成签名的随机串
                            signature: data.result.signature, // 必填，签名
                            jsApiList: ['updateTimelineShareData', 'updateAppMessageShareData'],
                        });
                        wx.ready(function () {
                            wx.updateTimelineShareData({
                                title: opt.title, // 分享标题
                                link: opt.link, // 分享链接
                                imgUrl: opt.img, // 分享图标
                                success: function () {
                                    // 用户确认分享后执行的回调函数
                                    cookieset.set('shareClick', 'true', {
                                        expires: cookieTime,
                                    });
                                    aplus_queue.push({
                                        action: 'aplus.record',
                                        arguments: ['link13', 'CLK', {
                                            shareType: '朋友圈',
                                        }],
                                    });
                                    stm_clicki('send', 'event', 'share', 'click', '朋友圈');

                                },
                            });
                            wx.updateAppMessageShareData({
                                title: opt.title, // 分享标题
                                desc: opt.desc, // 分享描述
                                link: opt.link, // 分享链接
                                imgUrl: opt.img,
                                success: function () {
                                    // 用户确认分享后执行的回调函数
                                    cookieset.set('shareClick', 'true', {
                                        expires: cookieTime,
                                    });
                                    aplus_queue.push({
                                        action: 'aplus.record',
                                        arguments: ['link13', 'CLK', {
                                            shareType: '微信好友',
                                        }],
                                    });
                                    stm_clicki('send', 'event', 'share', 'click', '微信好友');
                                },
                            });
                        });

                    } else {
                        alert('分享错误！');
                    }
                }
            });


            // 上报 PV
            aplus_queue.push({
                action: 'aplus.sendPV',
                arguments: [{ is_auto: false }, {
                    // 这里传参
                }]
            });
        });
    </script>
</body>

</html>